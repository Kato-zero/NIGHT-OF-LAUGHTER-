<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIGHT OF LAUGHTER Upcoming Events | Buy Tickets</title>
    <link rel="icon" type="image/png" sizes="512x512" href="favicon.png">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Night of Laughter is Zambia's premier comedy platform featuring top stand-up comedians like Chingliz, Ba Emma, Smoke, Juss, Rhema, and Bob Nkosha. Buy instant digital tickets for featured and upcoming comedy events in Lusaka and beyond.">
    <meta name="keywords" content="Night of Laughter, Zambia comedy event, stand-up comedy Zambia, ZED Laugh Festival, comedy shows Lusaka, Chingliz, Ba Emma, Smoke, Juss">
    <meta name="author" content="Night of Laughter Event Team">

    <style>
        :root {
            --blue: #007bff;
            --deep-blue: #1176d6;
            --gray-bg: #f2f2f2;
            --white: #fff;
            --black: #333;
            --offwhite: #f9f9f9;
            --card-shadow: 0 4px 10px rgba(0,0,0,.11);
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: system-ui, Arial, sans-serif;
            background: var(--gray-bg);
            color: var(--black);
        }

        header{
            width: 100%;
            background: var(--white);
            padding: 15px 5vw;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: fixed;
            top:0; left:0; z-index: 100;
        }

        .header-left { display: flex; align-items: center; }
        .header-logo { height: 105px; width: auto; }

        nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        nav a {
            padding: 8px 16px;
            color: var(--black);
            font-weight: 600;
            font-size: 12px;
            text-decoration: none;
            border-radius: 8px;
            transition: background .12s, color .14s;
        }

        nav a:hover, nav a:focus {
            background: #eaeaea;
            color: var(--blue);
        }

        .hero{ 
            width: 100%; height: 60vh; min-height: 290px;
            background: url('https://i.postimg.cc/28FNfrwW/1764496645079.jpg') center/cover no-repeat;
            display: flex; justify-content: center; align-items: center; text-align: center;
            padding: 0 7vw; margin-top: 65px;
        }

        .hero h1{ color: var(--white); font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,.3);}
        .hero p{ color: #eee; font-size: 1.15rem; margin-bottom: 18px; text-shadow: 0 2px 6px rgba(0,0,0,0.4);}

        .featured, .events, #testimonialsSection, #contactSection { 
            width: 100%; padding: 2rem 5vw 0 5vw; box-sizing: border-box; 
        }

        .event-list { display: flex; flex-wrap: wrap; gap: 2vw; justify-content: center; }

        .event-card {
            width: 100%;
            max-width: 370px;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            margin: 36px 0;
            display: flex;
            flex-direction: column;
            transition: box-shadow .13s;
        }

        .event-card:hover { box-shadow: 0 4px 16px rgba(17,118,214,0.11); }

        .event-thumb {
            width: 100%;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ebebeb;
        }

        .event-thumb img {
            width: 100%; height: 100%; object-fit: cover; display: block;
        }

        .event-content {
            padding: 15px;
            flex: 1;
            line-height: 1.6;
            display: flex; flex-direction: column; justify-content: flex-start;
        }

        .event-title{
            font-size: 1.2rem; font-weight: bold; margin-bottom: 6px;
        }

        .price-box {
            margin-top: 8px;
            padding: 10px;
            background: var(--offwhite);
            border-radius: 8px;
            font-size: 0.97em;
        }

        .btn-row{
            display: flex; gap:12px; margin-top: 14px;
        }

        .btn {
            flex: 1;
            padding: 11px 0;
            background: var(--blue);
            color: var(--white);
            text-align: center;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: background .11s, opacity .11s;
            font-size: 1rem;
        }

        .btn.info{ background: #444; }

        .btn:hover, .btn:focus { opacity:0.93;}

        footer{
            background: #222;
            padding: 20px 7vw;
            color: #ccc;
            text-align: center;
            margin-top: 50px;
            font-size: 0.95em;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.62);
            justify-content: center; align-items: center;
            z-index: 3000;
        }

        .modal-content {
            background: var(--white);
            padding: 18px;
            width: 95vw; max-width: 410px;
            border-radius: 15px;
            text-align: center;
            position: relative;
        }

        .close {
            position: absolute; top: 10px; right: 18px;
            font-size: 2.2rem; cursor: pointer;
        }

        .payment-option-btn {
            padding: 12px;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            border: 2px solid #e5e7eb;
            margin-top: 10px;
        }

        .payment-option-btn.whatsapp {
            background: #25D366;
            border-color: #25D366;
            color: white;
        }

        .btn-primary { background: var(--blue); color:white; padding:12px; border:none; border-radius:6px; cursor:pointer; }
        .btn-secondary { background:#ccc; padding:10px; border:none; border-radius:6px; cursor:pointer; margin-top:10px; }

        .loader {
            border: 4px solid #eee; border-top: 4px solid var(--blue);
            border-radius:50%; width:40px; height:40px;
            margin: auto; animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg);} 100%{transform:rotate(360deg);} }

    </style>
</head>

<body>

<header>
    <div class="header-left">
        <img src="logo.png" alt="Night of Laughter Logo" class="header-logo" loading="lazy">
    </div>
    <nav id="navMenu">
        <a href="#featuredSection">Featured Events</a>
        <a href="#eventsSection">Upcoming Events</a>
        <a href="#testimonialsSection">Testimonials</a>
        <a href="#contactSection">Contact</a>
    </nav>
</header>

<section class="hero">
    <div>
        <h1>NIGHT OF LAUGHTER</h1>
        <p>Instant digital tickets. No queues. No stress.</p>
    </div>
</section>

<section class="featured" id="featuredSection">
    <div id="featuredLoader" class="loader"></div>
</section>

<section class="events" id="eventsSection">
    <div id="eventsLoader" class="loader"></div>
</section>

<!-- Ticket Modal -->
<div id="ticketModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>

        <img id="ticketBanner" class="ticket-banner" style="width:100%; border-radius:10px;">

        <h2 id="eventNameDisplay"></h2>

        <div style="text-align:left; margin-bottom:20px; background:#f8f8f8; padding:15px; border-radius:8px;">
            <p><b>Date:</b> <span id="modalEventDate"></span></p>
            <p><b>Time:</b> <span id="modalEventTime"></span></p>
            <p><b>Venue:</b> <span id="modalEventVenue"></span></p>
        </div>

        <label for="ticketType"><b>Select Ticket Type</b></label>
        <select id="ticketType" required style="padding:10px; width:100%; border-radius:6px;">
            <option value="">-- Select Ticket Type --</option>
            <option value="vip_single">VIP Single</option>
            <option value="vip_double">VIP Double</option>
            <option value="ordinary_single">Ordinary Single</option>
            <option value="ordinary_double">Ordinary Double</option>
        </select>

        <div id="selectedTicketInfo" style="display:none; background:#e8f5e9; padding:12px; border-radius:8px; margin-top:10px;">
            <p><b>Selected:</b> <span id="selectedTypeDisplay"></span></p>
            <p><b>Price:</b> <span id="selectedPriceDisplay"></span></p>
        </div>

        <button class="btn-primary" onclick="proceedToPayment()">Proceed to Payment</button>
    </div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closePaymentModal()">&times;</span>

        <h2 id="paymentEventName"></h2>

        <div style="background:#f8f8f8; padding:15px; text-align:left; border-radius:8px;">
            <p><b>Ticket Type:</b> <span id="paymentTicketType"></span></p>
            <p><b>Total Amount:</b> <span id="paymentTotal"></span></p>
        </div>

        <button class="payment-option-btn whatsapp" onclick="processWhatsAppPayment()">Book & Pay via WhatsApp</button>
        <button class="payment-option-btn" onclick="redirectToPaymentLink()" style="background:var(--blue);color:white;">Go to Payment Page</button>

        <button class="btn-secondary" onclick="closePaymentModal()">Cancel</button>
    </div>
</div>

<footer>
    NIGHT OF LAUGHTER© 2025 • All Rights Reserved
</footer>

<script>
// ============================================
// CONFIG
// ============================================
const SHEETDB_API_URL = "https://sheetdb.io/api/v1/q1khgitf9299n";
const WHATSAPP_NUMBER = "260973299759";
let currentEvent = null;
let selectedTicketType = "";
let selectedTicketPrice = 0;

// Escape helper
function jsEscape(s){ return String(s || "").replace(/"/g,"&quot;").replace(/'/g,"&#39;"); }

// Toggle description
function toggleDescription(id){
    const el = document.getElementById(id);
    el.style.display = el.style.display === "block" ? "none" : "block";
}

// --- Render event card ---
function renderEventCard(ev, idx){
    const moreId = `desc_${idx}`;
    const safe = {
        name: jsEscape(ev.eventname),
        img: jsEscape(ev.image),
        date: jsEscape(ev.date),
        time: jsEscape(ev.time),
        venue: jsEscape(ev.venue),
    };

    const encoded = encodeURIComponent(JSON.stringify(ev));

    return `
    <div class="event-card">
        <div class="event-thumb">
            <img src="${safe.img}" alt="${safe.name}">
        </div>

        <div class="event-content">
            <div class="event-title">${safe.name}</div>
            <div><b>Date:</b> ${safe.date}</div>
            <div><b>Time:</b> ${safe.time}</div>
            <div><b>Venue:</b> ${safe.venue}</div>

            <div class="price-box">
                <b>Ticket Prices:</b><br>
                VIP Single: K${ev["vip single"]}<br>
                VIP Double: K${ev["vip double"]}<br>
                Ordinary Single: K${ev["ordinary single"]}<br>
                Ordinary Double: K${ev["ordinary double"]}
            </div>

            <div class="btn-row">
                <button class="btn" onclick="openTicketModal('${safe.name}','${safe.img}','${safe.date}','${safe.time}','${safe.venue}','${encoded}')">Buy Ticket</button>
                <button class="btn info" onclick="toggleDescription('${moreId}')">More Info</button>
            </div>

            <div id="${moreId}" style="display:none; margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                <p><b>Description:</b> ${ev.description || "No description available."}</p>
            </div>
        </div>
    </div>`;
}

// --- Render events into sections ---
function renderEvents(data){
    document.getElementById("featuredLoader").style.display = "none";
    document.getElementById("eventsLoader").style.display = "none";

    const featured = data.filter(e => (e.type || "").toLowerCase() === "featured");
    const upcoming = data.filter(e => (e.type || "").toLowerCase() === "upcoming");

    document.getElementById("featuredSection").innerHTML = `
        <h2>Featured Events</h2>
        <div class="event-list">
            ${featured.map(renderEventCard).join("")}
        </div>`;

    document.getElementById("eventsSection").innerHTML = `
        <h2>Upcoming Events</h2>
        <div class="event-list">
            ${upcoming.map(renderEventCard).join("")}
        </div>`;
}

// --- Open ticket modal ---
function openTicketModal(name, img, date, time, venue, encoded){
    currentEvent = JSON.parse(decodeURIComponent(encoded));

    document.getElementById("eventNameDisplay").textContent = name;
    document.getElementById("ticketBanner").src = img;
    document.getElementById("modalEventDate").textContent = date;
    document.getElementById("modalEventTime").textContent = time;
    document.getElementById("modalEventVenue").textContent = venue;

    document.getElementById("selectedTicketInfo").style.display = "none";

    selectedTicketType = "";
    selectedTicketPrice = 0;

    document.getElementById("ticketModal").style.display = "flex";
}

// --- Ticket type selection ---
document.getElementById("ticketType").addEventListener("change", function(){
    const type = this.value;
    if(!type){
        document.getElementById("selectedTicketInfo").style.display = "none";
        return;
    }

    const label = {
        vip_single: "VIP Single",
        vip_double: "VIP Double",
        ordinary_single: "Ordinary Single",
        ordinary_double: "Ordinary Double"
    }[type];

    selectedTicketType = type;
    selectedTicketPrice = Number(currentEvent[type.replace("_"," ")]);

    document.getElementById("selectedTypeDisplay").textContent = label;
    document.getElementById("selectedPriceDisplay").textContent = "K" + selectedTicketPrice;

    document.getElementById("selectedTicketInfo").style.display = "block";
});

// --- Proceed to payment ---
function proceedToPayment(){
    if(!selectedTicketType){
        alert("Select a ticket type first");
        return;
    }

    document.getElementById("paymentEventName").textContent = currentEvent.eventname;

    const typeLabel = {
        vip_single: "VIP Single",
        vip_double: "VIP Double",
        ordinary_single: "Ordinary Single",
        ordinary_double: "Ordinary Double"
    }[selectedTicketType];

    document.getElementById("paymentTicketType").textContent = typeLabel;
    document.getElementById("paymentTotal").textContent = "K" + selectedTicketPrice;

    closeModal();
    document.getElementById("paymentModal").style.display = "flex";
}

// --- Payment link ---
function getPaymentLink(){
    return currentEvent[`payment_link_${selectedTicketType}`] || "#";
}

// --- WhatsApp payment ---
function processWhatsAppPayment(){
    const msg = encodeURIComponent(
        `Hello! I want to book:\n\n` +
        `Event: ${currentEvent.eventname}\n` +
        `Date: ${currentEvent.date}\n` +
        `Time: ${currentEvent.time}\n` +
        `Venue: ${currentEvent.venue}\n` +
        `Ticket Type: ${selectedTicketType}\n` +
        `Amount: K${selectedTicketPrice}`
    );

    window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`, "_blank");
    closePaymentModal();
}

// --- Redirect to payment page ---
function redirectToPaymentLink(){
    window.open(getPaymentLink(), "_blank");
    closePaymentModal();
}

// --- Close modals ---
function closeModal(){ document.getElementById("ticketModal").style.display = "none"; }
function closePaymentModal(){ document.getElementById("paymentModal").style.display = "none"; }

// --- Fetch events ---
async function fetchEvents(){
    try{
        const r = await fetch(SHEETDB_API_URL);
        return await r.json();
    }catch(e){
        return [];
    }
}

// --- INIT ---
document.addEventListener("DOMContentLoaded", async () => {
    const events = await fetchEvents();
    renderEvents(events);

    window.onclick = e => {
        if(e.target.id === "ticketModal") closeModal();
        if(e.target.id === "paymentModal") closePaymentModal();
    };
});
</script>
</body>
</html>
