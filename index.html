<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Night of Laughter</title>
    <link rel="icon" type="image/png" sizes="512x512" href="favicon.png">
    <meta name="description" content="Zambia's comedy hub ‚Äì Chingliz, Ba Emma, Smoke, Juss. Instant digital tickets.">
    <style>
        /* ----- simplified & clean ----- */
        *{box-sizing:border-box;margin:0;padding:0;}
        :root{
            --blue:#007bff; --deep-blue:#1176d6; --gray-bg:#f2f2f2;
            --white:#fff; --black:#333; --offwhite:#f9f9f9;
            --card-shadow:0 4px 10px rgba(0,0,0,.08);
        }
        body{
            font-family:system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            background:var(--gray-bg); color:var(--black); line-height:1.5;
        }
        /* ----- HERO (covers header) ----- */
        .hero{
            width:100%; height:70vh; min-height:460px;
            background:linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.5)), 
                       url('https://i.postimg.cc/28FNfrwW/1764496645079.jpg') center/cover no-repeat;
            display:flex; align-items:center; justify-content:center; text-align:center;
            position:relative; isolation:isolate;
        }
        .hero-text{
            color:white; text-shadow:0 4px 18px rgba(0,0,0,0.5); padding:0 1rem;
        }
        .hero-text h1{
            font-size:clamp(2.2rem, 9vw, 5rem); font-weight:800; letter-spacing:-0.02em;
            margin-bottom:0.25rem;
        }
        .hero-text p{
            font-size:clamp(1.1rem, 4vw, 1.7rem); font-weight:300; opacity:0.95;
        }
        /* ----- navigation ‚Äì hamburger mobile, horizontal desktop (no fixed header) ----- */
        .page-header{
            position:absolute; top:0; left:0; width:100%; z-index:100;
            padding:1.5rem 5vw; display:flex; align-items:center; justify-content:space-between;
            background:transparent; color:white; pointer-events:none;
        }
        .header-logo{
            height:70px; width:auto; filter:drop-shadow(0 2px 6px #00000040); pointer-events:auto;
        }
        /* hamburger (mobile only) ‚Äì hidden on larger screens */
        #menu-toggle{display:none;}
        .menu-icon{
            display:none; pointer-events:auto; cursor:pointer;
            font-size:2.2rem; color:white; text-shadow:0 2px 6px black; line-height:1;
        }
        .nav-menu{
            display:flex; gap:0.75rem; flex-wrap:wrap; pointer-events:auto;
        }
        .nav-menu a{
            color:white; text-decoration:none; font-weight:600; font-size:1rem;
            padding:0.5rem 1.2rem; border-radius:40px; background:rgba(0,0,0,0.25);
            backdrop-filter:blur(4px); border:1px solid rgba(255,255,255,0.2);
            transition:0.15s; letter-spacing:0.3px;
        }
        .nav-menu a:hover{
            background:rgba(0,123,255,0.8); border-color:white; color:white;
        }

        /* mobile navigation: hidden by default, toggled by checkbox */
        @media (max-width: 640px){
            .menu-icon{display:block;}
            .nav-menu{
                position:fixed; top:0; right:-280px; width:250px; height:100vh;
                background:rgba(20,20,30,0.98); backdrop-filter:blur(8px);
                flex-direction:column; padding:6rem 1.5rem 2rem; gap:1.2rem;
                transition:right 0.3s ease; box-shadow:-5px 0 25px rgba(0,0,0,0.3);
                pointer-events:auto; z-index:999;
            }
            .nav-menu a{
                background:transparent; border:none; font-size:1.3rem; padding:0.3rem 0;
                border-bottom:1px solid #ffffff30; border-radius:0;
            }
            #menu-toggle:checked ~ .nav-menu{right:0;}
            /* close overlay hint */
            .menu-icon{position:relative; z-index:1001;}
            /* push hero top slightly */
            .hero{height:65vh; min-height:400px;}
        }

        /* ----- main sections (clean, no unused blocks) ----- */
        .section{
            width:100%; padding:3rem 5vw 2rem; max-width:1400px; margin:0 auto;
        }
        .section h2{
            font-size:2rem; margin-bottom:1.8rem; font-weight:600; color:#1e2a3a;
            border-left:6px solid var(--blue); padding-left:1.2rem;
        }
        .event-grid{
            display:flex; flex-wrap:wrap; gap:2rem; justify-content:center;
        }
        .event-card{
            background:var(--white); border-radius:24px; overflow:hidden;
            box-shadow:var(--card-shadow); width:100%; max-width:340px;
            transition:transform 0.2s, box-shadow 0.2s; display:flex; flex-direction:column;
        }
        .event-card:hover{transform:translateY(-6px); box-shadow:0 18px 30px rgba(0,0,0,0.12);}
        .event-thumb{
            aspect-ratio:1/1; background:#e0e0e0; overflow:hidden;
        }
        .event-thumb img{
            width:100%; height:100%; object-fit:cover; display:block;
        }
        .event-content{
            padding:1.4rem 1.2rem; flex:1; display:flex; flex-direction:column;
        }
        .event-title{
            font-size:1.4rem; font-weight:700; margin-bottom:0.25rem; line-height:1.3;
        }
        .event-detail{
            font-size:0.95rem; color:#4a5568; margin:0.2rem 0; display:flex; gap:0.4rem;
        }
        .detail-label{font-weight:600; min-width:3.8rem;}
        .price-box{
            background:#f0f4fa; border-radius:16px; padding:0.9rem; margin:1rem 0 0.8rem;
            font-size:0.95rem;
        }
        .price-line{display:flex; justify-content:space-between; margin:0.2rem 0;}
        .btn-group{
            display:flex; gap:0.7rem; margin-top:1rem; flex-wrap:wrap;
        }
        .btn{
            flex:1 1 auto; padding:0.7rem 0.2rem; border:none; border-radius:40px;
            font-weight:700; font-size:0.95rem; cursor:pointer; transition:0.15s;
            text-align:center; text-decoration:none; background:var(--blue); color:white;
            min-width:110px;
        }
        .btn-info{
            background:#2d3748; color:white;
        }
        .btn-info:hover{background:#1e2937;}
        .btn:hover{opacity:0.85; transform:scale(1.02);}

        .more-desc{
            margin-top:1rem; padding-top:1rem; border-top:1px solid #dee2e6;
            font-size:0.95rem; color:#2c3e50; display:none;
        }
        .more-desc.show{display:block;}

        /* testimonials & contact ‚Äì kept minimal */
        .testimonials, .contact{
            background:var(--white); border-radius:28px; padding:2.5rem 2rem;
            margin:2rem 5vw 3rem; box-shadow:0 5px 18px rgba(0,0,0,0.03);
        }
        .testimonials h2, .contact h2{font-size:1.8rem; border-left-color:#2b6c94;}

        /* ----- NEW: YouTube Video Section ----- */
        .video-section{
            background:var(--white); border-radius:28px; padding:2.5rem 2rem;
            margin:2rem 5vw 3rem; box-shadow:0 5px 18px rgba(0,0,0,0.03);
        }
        .video-section h2{
            font-size:1.8rem; margin-bottom:2rem; border-left:6px solid #ff0000; padding-left:1.2rem;
        }
        .video-grid{
            display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:2rem;
        }
        .video-card{
            background:#f8f9fa; border-radius:16px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08);
            cursor:pointer; transition:transform 0.3s ease;
        }
        .video-card:hover{
            transform:scale(1.02);
        }
        .video-thumbnail{
            position:relative; aspect-ratio:16/9; overflow:hidden;
        }
        .video-thumbnail img{
            width:100%; height:100%; object-fit:cover;
        }
        .play-button{
            position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
            width:60px; height:60px; background:rgba(255,0,0,0.9); border-radius:50%;
            display:flex; align-items:center; justify-content:center; color:white;
            font-size:30px; transition:all 0.3s ease;
        }
        .video-card:hover .play-button{
            transform:translate(-50%, -50%) scale(1.1);
            background:#ff0000;
        }
        .video-info{
            padding:1.2rem;
        }
        .video-info h3{
            font-size:1.2rem; margin-bottom:0.5rem; color:var(--black);
        }
        .video-info p{
            color:#666; font-size:0.9rem;
        }

        /* ----- NEW: Photo Gallery ----- */
        .gallery-section{
            background:var(--white); border-radius:28px; padding:2.5rem 2rem;
            margin:2rem 5vw 3rem; box-shadow:0 5px 18px rgba(0,0,0,0.03);
        }
        .gallery-section h2{
            font-size:1.8rem; margin-bottom:2rem; border-left:6px solid #28a745; padding-left:1.2rem;
        }
        .gallery-grid{
            display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:1.5rem;
        }
        .gallery-item{
            position:relative; border-radius:16px; overflow:hidden; cursor:pointer;
            aspect-ratio:1/1; box-shadow:0 4px 12px rgba(0,0,0,0.1);
            transition:transform 0.3s ease, box-shadow 0.3s ease;
        }
        .gallery-item:hover{
            transform:scale(1.03); box-shadow:0 8px 24px rgba(0,0,0,0.15);
        }
        .gallery-item img{
            width:100%; height:100%; object-fit:cover; display:block;
            transition:transform 0.5s ease;
        }
        .gallery-item:hover img{
            transform:scale(1.1);
        }
        .gallery-caption{
            position:absolute; bottom:0; left:0; right:0; background:linear-gradient(transparent, rgba(0,0,0,0.7));
            color:white; padding:1rem; font-size:0.9rem; transform:translateY(100%);
            transition:transform 0.3s ease;
        }
        .gallery-item:hover .gallery-caption{
            transform:translateY(0);
        }

        /* Unified Lightbox for Images and Videos */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 80%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .lightbox-content img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .lightbox-content iframe {
            width: 80vw;
            height: 45vw;
            max-width: 1200px;
            max-height: 675px;
            border: none;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            font-weight: bold;
            z-index: 2001;
            transition: color 0.3s ease;
        }

        .lightbox-close:hover {
            color: #ff0000;
        }

        .lightbox-prev, .lightbox-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 50px;
            cursor: pointer;
            padding: 20px;
            user-select: none;
            z-index: 2001;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .lightbox-prev {
            left: 20px;
        }

        .lightbox-next {
            right: 20px;
        }

        .lightbox-prev:hover, .lightbox-next:hover {
            background: var(--blue);
            transform: translateY(-50%) scale(1.1);
        }

        .lightbox-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 16px;
            background: rgba(0,0,0,0.7);
            padding: 8px 16px;
            border-radius: 20px;
            z-index: 2001;
        }

        .lightbox-caption {
            position: absolute;
            bottom: 70px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            font-size: 16px;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            max-width: 80%;
            margin: 0 auto;
            border-radius: 8px;
            z-index: 2001;
        }

        /* ----- BACK TO TOP BUTTON ----- */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--blue);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            border: 2px solid white;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--deep-blue);
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .back-to-top:active {
            transform: translateY(0);
        }

        /* Mobile adjustment for back to top button */
        @media (max-width: 640px) {
            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .lightbox-prev, .lightbox-next {
                width: 40px;
                height: 40px;
                font-size: 30px;
            }
            
            .lightbox-content iframe {
                width: 95vw;
                height: 53.44vw;
            }
        }

        footer{
            background:#1a2634; color:#adb5bd; text-align:center; padding:2rem;
            font-size:0.95rem; margin-top:3rem;
        }

        /* payment banner */
        .payment-banner{
            text-align:center; padding:1rem; margin:1rem 5vw 0; border-radius:60px;
            background:#d1ecf1; color:#0c5460; border:1px solid #bee5eb; display:none;
        }
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--blue); border-radius: 50%;
            width: 45px; height: 45px; animation: spin 1s linear infinite; margin:2rem auto;
        }
        @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    </style>
</head>
<body>

<!-- header with logo + hamburger (absolute over hero) -->
<header class="page-header">
    <img src="logo.png" alt="Night of Laughter" class="header-logo" loading="lazy" onerror="this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22120%22%20height%3D%2270%22%20viewBox%3D%220%200%20120%2070%22%3E%3Ctext%20x%3D%2210%22%20y%3D%2245%22%20font-size%3D%2224%22%20fill%3D%22%23ffffff%22%3ENoL%3C%2Ftext%3E%3C%2Fsvg%3E'">

    <!-- mobile hamburger (checkbox method, no js) -->
    <input type="checkbox" id="menu-toggle" style="display:none;">
    <label for="menu-toggle" class="menu-icon" aria-label="menu">‚ò∞</label>

    <nav class="nav-menu">
        <a href="#featured">Featured</a>
        <a href="#upcoming">Upcoming</a>
        <a href="#videos">Videos</a>
        <a href="#gallery">Gallery</a>
        <a href="#testimonials">Stories</a>
        <a href="#contact">Contact</a>
    </nav>
</header>

<!-- HERO SECTION (image covers everything) -->
<section class="hero">
    <div class="hero-text">
        <h1>NIGHT OF LAUGHTER</h1>
        <p>Events ¬∑ tickets ¬∑ payments</p>
    </div>
</section>

<!-- payment banner placeholder (hidden by default) -->
<div class="payment-banner" id="paymentBanner"></div>

<!-- FEATURED EVENTS section (loader visible until fetch) -->
<section class="section" id="featured">
    <h2>‚ú® Featured</h2>
    <div class="event-grid" id="featuredGrid">
        <div class="loader" style="margin:2rem auto;"></div>
    </div>
</section>

<!-- UPCOMING EVENTS section -->
<section class="section" id="upcoming">
    <h2>üìÖ Upcoming shows</h2>
    <div class="event-grid" id="upcomingGrid">
        <div class="loader" style="margin:2rem auto;"></div>
    </div>
</section>

<!-- YOUTUBE VIDEOS SECTION -->
<section id="videos" class="video-section">
    <h2>üé• Latest Comedy Highlights</h2>
    <div class="video-grid" id="videoGrid">
        <!-- Videos will be loaded here via JavaScript -->
        <div class="loader" style="margin:2rem auto;"></div>
    </div>
</section>

<!-- PHOTO GALLERY SECTION -->
<section id="gallery" class="gallery-section">
    <h2>üì∏ Event Gallery</h2>
    <div class="gallery-grid" id="galleryGrid">
        <!-- Gallery images will be loaded here via JavaScript -->
        <div class="loader" style="margin:2rem auto;"></div>
    </div>
</section>

<!-- TESTIMONIALS (brief) -->
<section id="testimonials" class="testimonials">
    <h2>What comedians say</h2>
    <p style="max-width:700px; color:#2d3e50;">‚ÄúNight of Laughter brings the best crowds ‚Äî and digital tickets mean fans just show their phone. Genius.‚Äù ‚Äî Chingliz</p>
    <p style="margin-top:1.5rem; font-style:italic;">‚ÄúPacked houses, smooth entry. No paper, no fuss.‚Äù ‚Äî Ba Emma</p>
</section>

<!-- CONTACT (short) -->
<section id="contact" class="contact">
    <h2>Contact / bookings</h2>
    <p>üìû +260 97 123 4567 (10am‚Äì4pm)</p>
</section>

<footer id="footer">
    NIGHT OF LAUGHTER ¬© 2025 ¬∑ by cmk web solutions
</footer>

<!-- BACK TO TOP BUTTON -->
<button class="back-to-top" id="backToTop" onclick="scrollToTop()" aria-label="Back to top">‚Üë</button>

<!-- Unified Lightbox for Images and Videos -->
<div class="lightbox" id="lightbox">
    <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
    <span class="lightbox-prev" onclick="changeLightboxItem(-1)">&#10094;</span>
    <span class="lightbox-next" onclick="changeLightboxItem(1)">&#10095;</span>
    <div class="lightbox-content" id="lightboxContent">
        <!-- Content loaded dynamically -->
    </div>
    <div class="lightbox-counter" id="lightboxCounter"></div>
    <div class="lightbox-caption" id="lightboxCaption"></div>
</div>

<!-- JavaScript for all functionality -->
<script>
// ---------- CONFIG ----------
const SHEETDB_API = "https://sheetdb.io/api/v1/sh60n2rxqi0zo";
const FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSd69gVqCrIRoLYt56gaZN6ZUW_ZuwLFeIKnHAkUtqys4NSLaA/viewform?usp=header";

// ---------- YOUTUBE VIDEOS CONFIG ----------
const YOUTUBE_VIDEOS = [
   
    {
        id: "Vd2TRJRQAxk", // From: https://youtu.be/Vd2TRJRQAxk?si=vn5L1d5B0ZUq3ldr
        title: "Best of Chingliz - Live at Night of Laughter",
        description: "Highlights from our latest show featuring Chingliz",
        thumbnail: "https://img.youtube.com/vi/Vd2TRJRQAxk/maxresdefault.jpg"
    },
    {
        id: "cluxU57wDYw", // From: https://youtu.be/cluxU57wDYw?si=r0ZixTXT9XdY6h69
        title: "Ba Emma's Hilarious Set",
        description: "Watch Ba Emma kill it on stage",
        thumbnail: "https://img.youtube.com/vi/cluxU57wDYw/maxresdefault.jpg"
    },
];

// ---------- GALLERY IMAGES CONFIG ----------
const GALLERY_IMAGES = [
    {
        url: "https://i.postimg.cc/L6J9YnQR/DEW-1.jpg",
        thumbnail: "https://i.postimg.cc/L6J9YnQR/DEW-1.jpg",
        caption: "Night of Laughter performance"
    },
    {
        url: "https://i.postimg.cc/ZRYZTRvj/DEW-11.jpg",
        thumbnail: "https://i.postimg.cc/ZRYZTRvj/DEW-11.jpg",
        caption: "Crowd enjoying the show"
    },
    {
        url: "https://i.postimg.cc/KvCZnxCj/DEW-22.jpg",
        thumbnail: "https://i.postimg.cc/KvCZnxCj/DEW-22.jpg",
        caption: "Comedy moment"
    },
    {
        url: "https://i.postimg.cc/8CmNQWcv/DEW-17.jpg",
        thumbnail: "https://i.postimg.cc/8CmNQWcv/DEW-17.jpg",
        caption: "Audience laughter"
    },
    {  
        url: "https://i.postimg.cc/zX4Jn86s/DEW-26.jpg",
        thumbnail: "https://i.postimg.cc/zX4Jn86s/DEW-26.jpg",
        caption: "Night of Laughter performance"
    },
    {
        url: "https://i.postimg.cc/zX4Jn845/DEW-28.jpg",
        thumbnail: "https://i.postimg.cc/zX4Jn845/DEW-28.jpg",
        caption: "Crowd enjoying the show"
    },
    {
        url: "https://i.postimg.cc/wT1qy74q/DEW-30.jpg",
        thumbnail: "https://i.postimg.cc/wT1qy74q/DEW-30.jpg",
        caption: "Comedy moment"
    },
    {
        url: "https://i.postimg.cc/J0vWc56Q/DEW-4.jpg",
        thumbnail: "https://i.postimg.cc/J0vWc56Q/DEW-4.jpg",
        caption: "Audience laughter"
    },
    {
        url: "https://i.postimg.cc/5NDxwbDc/DEW-36.jpg",
        thumbnail: "https://i.postimg.cc/5NDxwbDc/DEW-36.jpg",
        caption: "Stage performance"
    },
    
];
// Combined array for lightbox navigation
let lightboxItems = [];
let currentLightboxIndex = 0;

// ---------- UTILS ----------
function escapeHTML(str) {
    if(!str) return '';
    return String(str).replace(/[&<>"]/g, function(m){
        return m === '&' ? '&amp;' : m === '<' ? '&lt;' : m === '>' ? '&gt;' : m === '"' ? '&quot;' : m;
    });
}

function showBanner(msg, isSuccess = true) {
    const banner = document.getElementById('paymentBanner');
    banner.style.display = 'block';
    banner.textContent = msg;
    banner.style.background = isSuccess ? '#d4edda' : '#f8d7da';
    banner.style.color = isSuccess ? '#155724' : '#721c24';
    banner.style.borderColor = isSuccess ? '#c3e6cb' : '#f5c6cb';
    setTimeout(() => banner.style.display = 'none', 4000);
}

// ---------- BACK TO TOP FUNCTIONALITY ----------
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// Show back to top button only when footer is visible
window.addEventListener('scroll', function() {
    const backToTop = document.getElementById('backToTop');
    const footer = document.getElementById('footer');
    const footerRect = footer.getBoundingClientRect();
    const windowHeight = window.innerHeight;
    
    // Show button when footer comes into view
    if (footerRect.top <= windowHeight) {
        backToTop.classList.add('visible');
    } else {
        backToTop.classList.remove('visible');
    }
});

// ---------- UNIFIED LIGHTBOX FUNCTIONS ----------
function openLightbox(index) {
    currentLightboxIndex = index;
    updateLightbox();
    document.getElementById('lightbox').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeLightbox() {
    document.getElementById('lightbox').classList.remove('active');
    document.body.style.overflow = '';
    
    // Stop video if playing
    const lightboxContent = document.getElementById('lightboxContent');
    lightboxContent.innerHTML = '';
}

function changeLightboxItem(direction) {
    currentLightboxIndex += direction;
    
    if (currentLightboxIndex < 0) {
        currentLightboxIndex = lightboxItems.length - 1;
    } else if (currentLightboxIndex >= lightboxItems.length) {
        currentLightboxIndex = 0;
    }
    
    updateLightbox();
}

function updateLightbox() {
    const item = lightboxItems[currentLightboxIndex];
    const lightboxContent = document.getElementById('lightboxContent');
    const counter = document.getElementById('lightboxCounter');
    const caption = document.getElementById('lightboxCaption');
    
    // Clear previous content
    lightboxContent.innerHTML = '';
    
    if (item.type === 'image') {
        // Display image
        const img = document.createElement('img');
        img.src = item.url;
        img.alt = item.caption;
        lightboxContent.appendChild(img);
        caption.textContent = item.caption;
    } else if (item.type === 'video') {
        // Display YouTube video
        const iframe = document.createElement('iframe');
        iframe.src = `https://www.youtube.com/embed/${item.id}?autoplay=1`;
        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
        iframe.allowFullscreen = true;
        lightboxContent.appendChild(iframe);
        caption.textContent = item.title;
    }
    
    // Update counter
    counter.textContent = `${currentLightboxIndex + 1} / ${lightboxItems.length}`;
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    const lightbox = document.getElementById('lightbox');
    if (!lightbox.classList.contains('active')) return;
    
    if (e.key === 'Escape') {
        closeLightbox();
    } else if (e.key === 'ArrowLeft') {
        changeLightboxItem(-1);
    } else if (e.key === 'ArrowRight') {
        changeLightboxItem(1);
    }
});

// ---------- BUY HANDLER: DIRECT REDIRECT TO GOOGLE FORM ----------
function buyTicket(eventData) {
    sessionStorage.setItem('lastEvent', JSON.stringify({name: eventData.name || 'Event'}));
    window.open(FORM_URL, '_blank');
    showBanner('üìã Booking form opened in new tab', true);
}

function toggleDesc(id) {
    const el = document.getElementById(id);
    if(el) el.classList.toggle('show');
}

// ---------- RENDER EVENT CARDS ----------
function renderEventCard(ev, index) {
    const descId = `desc_${Date.now()}_${index}`;
    const name = escapeHTML(ev.name) || 'Laughter night';
    const date = escapeHTML(ev.date) || 'TBA';
    const time = escapeHTML(ev.time) || '19:00';
    const venue = escapeHTML(ev.venue) || 'Lusaka';
    const vipS = ev.vip_single && ev.vip_single != '0' ? `K${escapeHTML(ev.vip_single)}` : null;
    const vipD = ev.vip_double && ev.vip_double != '0' ? `K${escapeHTML(ev.vip_double)}` : null;
    const ordS = ev.ordinary_single && ev.ordinary_single != '0' ? `K${escapeHTML(ev.ordinary_single)}` : null;
    const ordD = ev.ordinary_double && ev.ordinary_double != '0' ? `K${escapeHTML(ev.ordinary_double)}` : null;
    
    const img = ev.image && ev.image.trim() !== '' ? escapeHTML(ev.image) : 'https://via.placeholder.com/400x400?text=COMEDY';
    const description = escapeHTML(ev.description || ev.desc || 'Get ready to laugh!');
    const lineup = ev.lineup ? escapeHTML(ev.lineup) : '';

    let priceHTML = '<div class="price-box">';
    if (vipS) priceHTML += `<div class="price-line"><span>VIP single</span> <strong>${vipS}</strong></div>`;
    if (vipD) priceHTML += `<div class="price-line"><span>VIP double</span> <strong>${vipD}</strong></div>`;
    if (ordS) priceHTML += `<div class="price-line"><span>Ordinary single</span> <strong>${ordS}</strong></div>`;
    if (ordD) priceHTML += `<div class="price-line"><span>Ordinary double</span> <strong>${ordD}</strong></div>`;
    if (!vipS && !vipD && !ordS && !ordD) priceHTML += '<div>Prices at venue</div>';
    priceHTML += '</div>';

    return `<div class="event-card">
        <div class="event-thumb"><img src="${img}" loading="lazy" alt="${name}" onerror="this.src='https://via.placeholder.com/400x400?text=event'"></div>
        <div class="event-content">
            <div class="event-title">${name}</div>
            <div class="event-detail"><span class="detail-label">Date</span> ${date} ¬∑ ${time}</div>
            <div class="event-detail"><span class="detail-label">Venue</span> ${venue}</div>
            ${priceHTML}
            <div class="btn-group">
                <button class="btn" onclick='buyTicket(${JSON.stringify(ev).replace(/'/g, "\\'")})'>üéüÔ∏è Buy</button>
                <button class="btn btn-info" onclick="toggleDesc('${descId}')">‚ÑπÔ∏è More</button>
            </div>
            <div id="${descId}" class="more-desc">
                <p>${description}</p>
                ${lineup ? '<p><strong>Lineup:</strong> '+lineup+'</p>' : ''}
            </div>
        </div>
    </div>`;
}

// ---------- RENDER YOUTUBE VIDEOS ----------
function renderVideos() {
    const videoGrid = document.getElementById('videoGrid');
    
    if (!YOUTUBE_VIDEOS || YOUTUBE_VIDEOS.length === 0) {
        videoGrid.innerHTML = '<p style="text-align:center; color:#666;">No videos available yet.</p>';
        return;
    }
    
    // Add videos to lightbox items
    YOUTUBE_VIDEOS.forEach(video => {
        lightboxItems.push({
            type: 'video',
            id: video.id,
            title: video.title,
            description: video.description
        });
    });
    
    videoGrid.innerHTML = YOUTUBE_VIDEOS.map((video, index) => {
        // Calculate the correct index in lightboxItems
        const lightboxIndex = index; // Videos come first in lightboxItems
        return `
            <div class="video-card" onclick="openLightbox(${lightboxIndex})">
                <div class="video-thumbnail">
                    <img src="${video.thumbnail || `https://img.youtube.com/vi/${video.id}/mqdefault.jpg`}" 
                         alt="${escapeHTML(video.title)}"
                         onerror="this.src='https://via.placeholder.com/320x180?text=Video+Thumbnail'">
                    <div class="play-button">‚ñ∂</div>
                </div>
                <div class="video-info">
                    <h3>${escapeHTML(video.title)}</h3>
                    <p>${escapeHTML(video.description)}</p>
                </div>
            </div>
        `;
    }).join('');
}

// ---------- RENDER GALLERY ----------
function renderGallery() {
    const galleryGrid = document.getElementById('galleryGrid');
    
    if (!GALLERY_IMAGES || GALLERY_IMAGES.length === 0) {
        galleryGrid.innerHTML = '<p style="text-align:center; color:#666;">No gallery images yet.</p>';
        return;
    }
    
    // Get current lightbox items length before adding images
    const videoCount = lightboxItems.length;
    
    // Add images to lightbox items (after videos)
    GALLERY_IMAGES.forEach(image => {
        lightboxItems.push({
            type: 'image',
            url: image.url,
            thumbnail: image.thumbnail,
            caption: image.caption
        });
    });
    
    galleryGrid.innerHTML = GALLERY_IMAGES.map((image, index) => {
        // Calculate the correct index in lightboxItems (videos + images)
        const lightboxIndex = videoCount + index;
        return `
            <div class="gallery-item" onclick="openLightbox(${lightboxIndex})">
                <img src="${escapeHTML(image.thumbnail)}" loading="lazy" alt="${escapeHTML(image.caption)}">
                <div class="gallery-caption">${escapeHTML(image.caption)}</div>
            </div>
        `;
    }).join('');
}

// ---------- FETCH + RENDER EVENTS ----------
async function fetchAndRender() {
    try {
        const resp = await fetch(SHEETDB_API);
        if (!resp.ok) throw new Error('Network');
        const events = await resp.json();
        
        const featured = events.filter(ev => ev.type && ev.type.toLowerCase().includes('featured'));
        const upcoming = events.filter(ev => !ev.type || !ev.type.toLowerCase().includes('featured'));

        const featuredGrid = document.getElementById('featuredGrid');
        const upcomingGrid = document.getElementById('upcomingGrid');

        if (featured.length) {
            featuredGrid.innerHTML = featured.map((ev, i) => renderEventCard(ev, `f_${i}`)).join('');
        } else {
            featuredGrid.innerHTML = '<p style="width:100%; text-align:center; color:#556;">üåü Featured shows coming soon</p>';
        }

        if (upcoming.length) {
            upcomingGrid.innerHTML = upcoming.map((ev, i) => renderEventCard(ev, `u_${i}`)).join('');
        } else {
            upcomingGrid.innerHTML = '<p style="width:100%; text-align:center; color:#556;">üìÜ Next events announced soon</p>';
        }
    } catch (e) {
        console.warn(e);
        document.getElementById('featuredGrid').innerHTML = '<p style="color:#b33;">Could not load events. Refresh or contact us.</p>';
        document.getElementById('upcomingGrid').innerHTML = '';
        showBanner('‚ö†Ô∏è Events offline, but tickets via contact', false);
    }
}

// ---------- check payment return (simulate from url) ----------
function checkPaymentReturn() {
    const params = new URLSearchParams(location.search);
    if (params.get('payment') === 'success') {
        showBanner('‚úÖ Payment successful! Check your email for tickets.', true);
    } else if (params.get('payment') === 'fail') {
        showBanner('‚ùå Payment incomplete, please try again.', false);
    }
}

// ---------- INITIALIZE ----------
document.addEventListener('DOMContentLoaded', () => {
    fetchAndRender();
    renderVideos();  // This adds videos to lightboxItems
    renderGallery(); // This adds images to lightboxItems
    checkPaymentReturn();
    setInterval(fetchAndRender, 300000); // Refresh events every 5 minutes
});
</script>
</body>
</html>
