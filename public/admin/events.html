<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Events</title>
  <link rel="stylesheet" href="/admin/styles.css">
</head>
<body>

<div class="header">
  <h1>Events</h1>
  <div>
    <a class="link" href="/admin/dashboard.html">Dashboard</a>
    <a class="link" href="/admin/tickets.html">Tickets</a>
    <button class="logout" onclick="logout()">Logout</button>
  </div>
</div>

<div class="container">
  <div class="card">
    <h3>Create Event</h3>
    <input id="name" class="input" placeholder="Event Name">
    <input id="date" class="input" type="date" style="margin-top:10px">
    <input id="venue" class="input" placeholder="Venue" style="margin-top:10px">
    <input id="poster" class="input" placeholder="Poster URL" style="margin-top:10px">
    <textarea id="desc" class="input" placeholder="Description" style="margin-top:10px"></textarea>
    <button class="btn" style="margin-top:12px" onclick="createEvent()">Save</button>
    <p id="msg" class="small"></p>
  </div>

  <div class="card">
    <h3>Existing Events</h3>
    <div id="list"></div>
  </div>
</div>

<script>
if(!localStorage.getItem('admin_token')) location.href='/admin/login.html';

function auth(){ return { 'Authorization': 'Bearer '+localStorage.getItem('admin_token'), 'Content-Type':'application/json' }; }
function logout(){ localStorage.removeItem('admin_token'); location.href='/admin/login.html'; }

async function createEvent(){
  const body = {
    name: name.value,
    date: date.value,
    venue: venue.value,
    posterUrl: poster.value,
    desc: desc.value
  };
  const r = await fetch('/api/admin/events',{ method:'POST', headers: auth(), body: JSON.stringify(body)});
  const j = await r.json();
  msg.textContent = r.ok ? 'Event created!' : j.error;
  loadEvents();
}

async function loadEvents(){
  const r = await fetch('/api/admin/events',{ headers: auth() });
  const j = await r.json();
  list.innerHTML = '';
  j.forEach(ev=>{
    const div = document.createElement('div');
    div.className='card';
    div.innerHTML = `<strong>${ev.name}</strong><br><span class="small">${ev.venue}</span>
    <button class="btn" style="background:#e33;margin-top:10px" onclick="del('${ev._id}')">Delete</button>`;
    list.appendChild(div);
  });
}

async function del(id){
  if(!confirm("Delete event?")) return;
  await fetch('/api/admin/events/'+id,{method:'DELETE',headers:auth()});
  loadEvents();
}

loadEvents();
</script>

</body>
  </html>
